// svg-injector.js 1.0.1
//
// Copyright (c) 2014 Waybury <hello@waybury.com>
// SVGInjector may be freely distributed under the MIT license.
//
// For full details and documentation:
// https://github.com/iconic/SVGInjector

!function(t,e){"use strict";var r="file:"===t.location.protocol,n=e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),o={},i=0,a=[],s={},l=function(t){return t.cloneNode(!0)},u=function(t,e){a[t]=a[t]||[],a[t].push(e)},c=function(t){for(var e=0,r=a[t].length;r>e;e++)!function(e){setTimeout(function(){a[t][e](l(o[t]))},0)}(e)},f=function(e,n){if(void 0!==o[e])o[e]instanceof SVGSVGElement?n(o[e].cloneNode(!0)):u(e,n);else{if(!t.XMLHttpRequest)return n("Browser does not support XMLHttpRequest"),!1;o[e]={},u(e,n);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState){if(404===i.status||null===i.responseXML)return n("Unable to load SVG file: "+e),r&&n("Note: SVG injection ajax calls do not work locally without adjusting security setting in your browser. Or consider using a local webserver."),n(),!1;if(!(200===i.status||r&&0===i.status))return n("There was a problem injecting the SVG: "+i.status+" "+i.statusText),!1;if(i.responseXML instanceof Document)o[e]=i.responseXML.documentElement;else if(DOMParser&&DOMParser instanceof Function){var t;try{var a=new DOMParser;t=a.parseFromString(i.responseText,"text/xml")}catch(s){t=void 0}if(!t||t.getElementsByTagName("parsererror").length)return n("Unable to parse SVG file: "+e),!1;o[e]=t.documentElement}c(e)}},i.open("GET",e),i.overrideMimeType&&i.overrideMimeType("text/xml"),i.send()}},p=function(e,r,o,a){var l=e.getAttribute("data-src")||e.getAttribute("src");return/svg$/i.test(l)?n?(e.setAttribute("src",""),void f(l,function(n){if(void 0===n||"string"==typeof n)return a(n),!1;var o=e.getAttribute("id");o&&n.setAttribute("id",o);var u=e.getAttribute("title");u&&n.setAttribute("title",u);var c=e.getAttribute("class");if(c){var f=[n.getAttribute("class"),"iconic-injected-svg",c].join(" ");n.setAttribute("class",f)}var p=e.getAttribute("style");p&&n.setAttribute("style",p);var d=[].filter.call(e.attributes,function(t){return/^data-\w[\w\-]*$/.test(t.name)});Array.prototype.forEach.call(d,function(t){t.name&&t.value&&n.setAttribute(t.name,t.value)});for(var v,h=n.querySelectorAll("defs clipPath[id]"),g=0,y=h.length;y>g;g++){v=h[g].id+"-"+i;for(var m=n.querySelectorAll('[clip-path*="'+h[g].id+'"]'),b=0,A=m.length;A>b;b++)m[b].setAttribute("clip-path","url(#"+v+")");h[g].id=v}n.removeAttribute("xmlns:a");for(var w,S,x=n.querySelectorAll("script"),j=[],T=0,G=x.length;G>T;T++)S=x[T].getAttribute("type"),S&&"application/ecmascript"!==S&&"application/javascript"!==S||(w=x[T].innerText||x[T].textContent,j.push(w),n.removeChild(x[T]));if(j.length>0&&("always"===r||"once"===r&&!s[l])){for(var M=0,E=j.length;E>M;M++)new Function(j[M])(t);s[l]=!0}e.parentNode.replaceChild(n,e),i++,a(n)})):void(o?(e.setAttribute("src",o+"/"+l.split("/").pop().replace(".svg",".png")),a(null)):a("This browser does not support SVG and no PNG fallback was defined.")):void a("Attempted to inject a file with a non-svg extension: "+l)};Array.prototype.forEach||(Array.prototype.forEach=function(t,e){if(void 0===this||null===this||"function"!=typeof t)throw new TypeError;var r,n=this.length>>>0;for(r=0;n>r;++r)r in this&&t.call(e,this[r],r,this)});var d=function(t,e,r){e=e||{};var n=e.evalScripts||"always",o=e.pngFallback||!1,i=e.each;if(void 0!==t.length){var a=0;Array.prototype.forEach.call(t,function(e){p(e,n,o,function(e){i&&"function"==typeof i&&i(e),r&&t.length===++a&&r(a)})})}else null!==t?p(t,n,o,function(t){i&&"function"==typeof i&&i(t),r&&r(1)}):r&&r(0)};"object"==typeof module&&"object"==typeof module.exports?module.exports=exports=d:"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof t&&(t.SVGInjector=d)}(window,document);